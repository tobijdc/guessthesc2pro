
const players = [
    {
        "id": 485,
        "tag": "Serral",
        "name": "Joona Sotala",
        "romanized_name": "NULL",
        "birthday": "1998-03-22",
        "country": "FI",
        "race": "Z",
        "rating": 2.745954957991117,
        "position": 1
    },
    {
        "id": 5878,
        "tag": "Clem",
        "name": "Cl√©ment Desplanches",
        "romanized_name": "NULL",
        "birthday": "2002-04-08",
        "country": "FR",
        "race": "T",
        "rating": 2.55549353734711,
        "position": 2
    },
    {
        "id": 19591,
        "tag": "MaxPax",
        "name": "NULL",
        "romanized_name": "NULL",
        "birthday": "2004-07-01",
        "country": "DK",
        "race": "P",
        "rating": 2.44602283999868,
        "position": 3
    },
    {
        "id": 49,
        "tag": "Maru",
        "name": "Ï°∞ÏÑ±Ï£º",
        "romanized_name": "Cho Seong Ju",
        "birthday": "1997-07-28",
        "country": "KR",
        "race": "T",
        "rating": 2.4233965587672825,
        "position": 4
    },
    {
        "id": 233,
        "tag": "herO",
        "name": "ÍπÄÏ§ÄÌò∏",
        "romanized_name": "Kim Joon Ho",
        "birthday": "1992-08-18",
        "country": "KR",
        "race": "P",
        "rating": 2.423004655445852,
        "position": 5
    },
    {
        "id": 76,
        "tag": "Dark",
        "name": "Î∞ïÎ†πÏö∞",
        "romanized_name": "Park Ryung Woo",
        "birthday": "1995-10-06",
        "country": "KR",
        "race": "Z",
        "rating": 2.3693477989419103,
        "position": 6
    },
    {
        "id": 5414,
        "tag": "Reynor",
        "name": "Riccardo Romiti",
        "romanized_name": "NULL",
        "birthday": "2002-07-01",
        "country": "IT",
        "race": "Z",
        "rating": 2.3203960669983568,
        "position": 7
    },
    {
        "id": 47,
        "tag": "ByuN",
        "name": "Î≥ÄÌòÑÏö∞",
        "romanized_name": "Byun Hyun Woo",
        "birthday": "1993-05-08",
        "country": "KR",
        "race": "T",
        "rating": 2.30823589432285,
        "position": 8
    },
    {
        "id": 1793,
        "tag": "Solar",
        "name": "Í∞ïÎØºÏàò",
        "romanized_name": "Kang Min Soo",
        "birthday": "1996-05-09",
        "country": "KR",
        "race": "Z",
        "rating": 2.2307688124170144,
        "position": 9
    },
    {
        "id": 1665,
        "tag": "Cure",
        "name": "ÍπÄÎèÑÏö±",
        "romanized_name": "Kim Doh Wook",
        "birthday": "1994-11-25",
        "country": "KR",
        "race": "T",
        "rating": 2.17881364841307,
        "position": 10
    },
    {
        "id": 258,
        "tag": "HeRoMaRinE",
        "name": "Gabriel Segat",
        "romanized_name": "",
        "birthday": "1997-07-04",
        "country": "DE",
        "race": "T",
        "rating": 2.02140775117387,
        "position": 11
    },
    {
        "id": 10115,
        "tag": "Oliveira",
        "name": "ÊùéÂüπÊ•†",
        "romanized_name": "Li Peinan",
        "birthday": "2000-06-28",
        "country": "CN",
        "race": "T",
        "rating": 2.01894005647133,
        "position": 12
    },
    {
        "id": 117,
        "tag": "SHIN",
        "name": "Ïã†Ìù¨Î≤î",
        "romanized_name": "Shin Hee Bum",
        "birthday": "1996-09-03",
        "country": "KR",
        "race": "Z",
        "rating": 2.00373511506289,
        "position": 13
    },
    {
        "id": 1662,
        "tag": "Rogue",
        "name": "Ïù¥Î≥ëÎ†¨",
        "romanized_name": "Lee Byung Ryul",
        "birthday": "1994-01-13",
        "country": "KR",
        "race": "Z",
        "rating": 1.97821094086991,
        "position": "NULL"
    },
    {
        "id": 44,
        "tag": "GuMiho",
        "name": "Í≥†Î≥ëÏû¨",
        "romanized_name": "Koh Byung Jae",
        "birthday": "1992-08-04",
        "country": "KR",
        "race": "T",
        "rating": 1.97785509782719,
        "position": 14
    },
    {
        "id": 4495,
        "tag": "Neeb",
        "name": "Alex Sunderhaft",
        "romanized_name": "NULL",
        "birthday": "1998-02-17",
        "country": "US",
        "race": "P",
        "rating": 1.96548320564563,
        "position": "NULL"
    },
    {
        "id": 186,
        "tag": "Classic",
        "name": "ÍπÄÎèÑÏö∞",
        "romanized_name": "Kim Doh Woo",
        "birthday": "1991-11-27",
        "country": "KR",
        "race": "P",
        "rating": 1.95940014995287,
        "position": 15
    },
    {
        "id": 1658,
        "tag": "Zest",
        "name": "Ï£ºÏÑ±Ïö±",
        "romanized_name": "Joo Sung Wook",
        "birthday": "1992-07-11",
        "country": "KR",
        "race": "P",
        "rating": 1.94419936975125,
        "position": "NULL"
    },
    {
        "id": 5,
        "tag": "PartinG",
        "name": "ÏõêÏù¥ÏÇ≠",
        "romanized_name": "Won Lee Sak",
        "birthday": "1994-08-24",
        "country": "KR",
        "race": "P",
        "rating": 1.8964629507308128,
        "position": 16
    },
    {
        "id": 4,
        "tag": "DRG",
        "name": "Î∞ïÏàòÌò∏",
        "romanized_name": "Park Soo Ho",
        "birthday": "1991-06-03",
        "country": "KR",
        "race": "Z",
        "rating": 1.89353037356608,
        "position": 17
    },
    {
        "id": 2,
        "tag": "Creator",
        "name": "Ïû•ÌòÑÏö∞",
        "romanized_name": "Jang Hyun Woo",
        "birthday": "1997-02-23",
        "country": "KR",
        "race": "P",
        "rating": 1.87768583505543,
        "position": 18
    },
    {
        "id": 2170,
        "tag": "ShoWTimE",
        "name": "Tobias Sieber",
        "romanized_name": "NULL",
        "birthday": "1994-02-23",
        "country": "DE",
        "race": "P",
        "rating": 1.8747519420518,
        "position": 19
    },
    {
        "id": 2053,
        "tag": "Zoun",
        "name": "Î∞ïÌïúÏÜî",
        "romanized_name": "Park Han Sol",
        "birthday": "1997-06-17",
        "country": "KR",
        "race": "P",
        "rating": 1.84513764483654,
        "position": "NULL"
    },
    {
        "id": 4049,
        "tag": "Lambo",
        "name": "Julian Brosig",
        "romanized_name": "NULL",
        "birthday": "1995-11-10",
        "country": "DE",
        "race": "Z",
        "rating": 1.83866523598793,
        "position": 20
    },
    {
        "id": 1517,
        "tag": "Bunny",
        "name": "Ïù¥Ïû¨ÏÑ†",
        "romanized_name": "Lee Jae Sun",
        "birthday": "1995-09-11",
        "country": "KR",
        "race": "T",
        "rating": 1.83722989008745,
        "position": 21
    },
    {
        "id": 8148,
        "tag": "NightMare",
        "name": "Ïû•Ïö±",
        "romanized_name": "Jang Wook",
        "birthday": "1999-02-23",
        "country": "KR",
        "race": "P",
        "rating": 1.83307557052765,
        "position": 22
    },
    {
        "id": 177,
        "tag": "Trap",
        "name": "Ï°∞ÏÑ±Ìò∏",
        "romanized_name": "Cho Sung Ho",
        "birthday": "1994-03-24",
        "country": "KR",
        "race": "P",
        "rating": 1.82451812662498,
        "position": "NULL"
    },
    {
        "id": 8676,
        "tag": "SKillous",
        "name": "–ù–∏–∫–∏—Ç–∞ –ì—É—Ä–µ–≤–∏—á",
        "romanized_name": "Nikita Gurevich",
        "birthday": "2001-04-17",
        "country": "RU",
        "race": "P",
        "rating": 1.81465039306422,
        "position": 23
    },
    {
        "id": 4134,
        "tag": "Astrea",
        "name": "Max Angel",
        "romanized_name": "NULL",
        "birthday": "1997-03-08",
        "country": "US",
        "race": "P",
        "rating": 1.80516552615102,
        "position": 24
    },
    {
        "id": 5847,
        "tag": "Elazer",
        "name": "Miko≈Çaj Ogonowski",
        "romanized_name": "NULL",
        "birthday": "1997-12-11",
        "country": "PL",
        "race": "Z",
        "rating": 1.79657975263624,
        "position": 25
    },
    {
        "id": 48,
        "tag": "INnoVation",
        "name": "Ïù¥Ïã†Ìòï",
        "romanized_name": "Lee Shin Hyung",
        "birthday": "1993-07-25",
        "country": "KR",
        "race": "T",
        "rating": 1.79029793001714,
        "position": "NULL"
    },
    {
        "id": 4452,
        "tag": "Spirit",
        "name": "Piotr Walukiewicz",
        "romanized_name": "NULL",
        "birthday": "1998-10-08",
        "country": "PL",
        "race": "T",
        "rating": 1.78770245061966,
        "position": 26
    },
    {
        "id": 309,
        "tag": "Stats",
        "name": "ÍπÄÎåÄÏóΩ",
        "romanized_name": "Kim Dae Yeob",
        "birthday": "1992-05-15",
        "country": "KR",
        "race": "P",
        "rating": 1.75410795985638,
        "position": 27
    },
    {
        "id": 23,
        "tag": "Scarlett",
        "name": "Sasha Hostyn",
        "romanized_name": "NULL",
        "birthday": "1993-12-14",
        "country": "CA",
        "race": "Z",
        "rating": 1.71825981082724,
        "position": 28
    },
    {
        "id": 35,
        "tag": "Ryung",
        "name": "ÍπÄÎèôÏõê",
        "romanized_name": "Kim Dong Won",
        "birthday": "1991-04-16",
        "country": "KR",
        "race": "T",
        "rating": 1.69274222798226,
        "position": 29
    },
    {
        "id": 23496,
        "tag": "Reynor",
        "name": "Riccardo Romiti",
        "romanized_name": "NULL",
        "birthday": "2002-07-01",
        "country": "IT",
        "race": "S",
        "rating": 1.68806233741458,
        "position": 30
    },
    {
        "id": 109,
        "tag": "Dream",
        "name": "Ï°∞Ï§ëÌòÅ",
        "romanized_name": "Cho Joong Hyuk",
        "birthday": "1996-10-27",
        "country": "KR",
        "race": "T",
        "rating": 1.68564353418834,
        "position": "NULL"
    },
    {
        "id": 13361,
        "tag": "Firefly",
        "name": "ËñõÊ∂õ",
        "romanized_name": "Xue Tao",
        "birthday": "2000-10-02",
        "country": "CN",
        "race": "P",
        "rating": 1.68532424035139,
        "position": 31
    },
    {
        "id": 4105,
        "tag": "Kelazhur",
        "name": "Diego Guilherme Schwimer",
        "romanized_name": "NULL",
        "birthday": "1995-10-10",
        "country": "BR",
        "race": "T",
        "rating": 1.65978894764392,
        "position": 32
    },
    {
        "id": 184,
        "tag": "SpeCial",
        "name": "Juan Carlos Tena Lopez",
        "romanized_name": "NULL",
        "birthday": "1993-05-20",
        "country": "MX",
        "race": "T",
        "rating": 1.64053264529104,
        "position": 33
    },
    {
        "id": 13216,
        "tag": "Wayne",
        "name": "–ò–≤–∞–Ω –ß–µ–ø—É—Ä–Ω–æ–≤",
        "romanized_name": "Ivan Chepurnov",
        "birthday": "2001-06-09",
        "country": "RU",
        "race": "Z",
        "rating": 1.63011138147428,
        "position": 34
    },
    {
        "id": 1659,
        "tag": "Dear",
        "name": "Î∞±ÎèôÏ§Ä",
        "romanized_name": "Baek Dong Jun",
        "birthday": "1994-04-25",
        "country": "KR",
        "race": "P",
        "rating": 1.62206873829022,
        "position": "NULL"
    },
    {
        "id": 110,
        "tag": "sOs",
        "name": "ÍπÄÏú†ÏßÑ",
        "romanized_name": "Kim Yoo Jin",
        "birthday": "1993-10-16",
        "country": "KR",
        "race": "P",
        "rating": 1.60425570546937,
        "position": "NULL"
    },
    {
        "id": 214,
        "tag": "Harstem",
        "name": "Kevin de Koning",
        "romanized_name": "NULL",
        "birthday": "1994-07-28",
        "country": "NL",
        "race": "P",
        "rating": 1.59622911990081,
        "position": 35
    },
    {
        "id": 63,
        "tag": "TY",
        "name": "Ï†ÑÌÉúÏñë",
        "romanized_name": "Jun Tae Yang",
        "birthday": "1994-09-18",
        "country": "KR",
        "race": "T",
        "rating": 1.58295973078416,
        "position": "NULL"
    },
    {
        "id": 1171,
        "tag": "Strange",
        "name": "–ê–ª–µ–∫—Å–µ–π –°–æ–ª—è–∫–æ–≤",
        "romanized_name": "Alexey Solyakov",
        "birthday": "1997-03-04",
        "country": "RU",
        "race": "P",
        "rating": 1.56306953896648,
        "position": 36
    },
    {
        "id": 1649,
        "tag": "MarineLorD",
        "name": "Alexis Eusebio",
        "romanized_name": "NULL",
        "birthday": "1995-06-01",
        "country": "FR",
        "race": "T",
        "rating": 1.55301982095323,
        "position": "NULL"
    },
    {
        "id": 125,
        "tag": "soO",
        "name": "Ïñ¥Ïú§Ïàò",
        "romanized_name": "Eo Yun Su",
        "birthday": "1992-09-24",
        "country": "KR",
        "race": "Z",
        "rating": 1.5515491579998992,
        "position": 37
    },
    {
        "id": 24,
        "tag": "KeeN",
        "name": "Ìô©Í∑úÏÑù",
        "romanized_name": "Hwang Kyu Seok",
        "birthday": "1994-10-02",
        "country": "KR",
        "race": "T",
        "rating": 1.52073096428019,
        "position": 38
    },
    {
        "id": 300,
        "tag": "FanTaSy",
        "name": "Ï†ïÎ™ÖÌõà",
        "romanized_name": "Jung Myung Hoon",
        "birthday": "1991-07-01",
        "country": "KR",
        "race": "T",
        "rating": 1.50526335934731,
        "position": "NULL"
    },
    {
        "id": 58,
        "tag": "MaNa",
        "name": "Grzegorz Komincz",
        "romanized_name": "NULL",
        "birthday": "1993-12-14",
        "country": "PL",
        "race": "P",
        "rating": 1.49325498486052,
        "position": 39
    },
    {
        "id": 4370,
        "tag": "GunGFuBanDa",
        "name": "Fabian Mayer",
        "romanized_name": "NULL",
        "birthday": "1998-04-23",
        "country": "DE",
        "race": "P",
        "rating": 1.48137238607535,
        "position": 40
    }
]

const fuseOptions = {
    // isCaseSensitive: false,
    // includeScore: false,
    // shouldSort: true,
    // includeMatches: false,
    // findAllMatches: false,
    // minMatchCharLength: 1,
    // location: 0,
    threshold: 0.3,
    // distance: 100,
    // useExtendedSearch: false,
    // ignoreLocation: false,
    // ignoreFieldNorm: false,
    // fieldNormWeight: 1,
    keys: [
        "tag"
    ]
};


const fuse = new Fuse(JSON.parse(JSON.stringify(players)), fuseOptions);

var main_player = players[Math.floor(Math.random() * players.length)];
var number_of_guesses = 5;

function reset() {
    main_player = players[Math.floor(Math.random() * players.length)];
    number_of_guesses = 5;
    document.getElementById('number-of-tries').innerHTML = number_of_guesses;
    document.getElementById('result-display').innerHTML = "";
}

function elementSelectCallback(event) {
    document.getElementById('search-result').innerHTML = "";
    document.getElementById('player_tag').value = this.innerText
}

function renderListElementWithCallback(text) {
    var element = document.createElement("li");
    element.innerText = text;
    element.addEventListener("click", elementSelectCallback);
    return element;
}

function search() {
    const input = document.getElementById('player_tag').value;
    //console.log(input);
    const result = fuse.search(input, {limit: 10});
    const tags = result.map(function (item) { return players[item["refIndex"]].tag; });
    var suggestions = document.getElementById('search-result');
    suggestions.innerHTML = "";
    for (i = 0; i < tags.length; i++) {
        suggestions.appendChild(renderListElementWithCallback(tags[i]));
    }
}

function formatActive(text) {
    if (text === "NULL") {
        return "Inactive";
    } else {
        return "Active";
    }
}

function birthdayEmptyOrNull(player) {
    return player.birthday == "NULL" || player.birthday == "";
}

function beforeOrAfter(guess, actual) {
    if (guess > actual) {
        return "‚¨áÔ∏è";
    } else {
        return "‚¨ÜÔ∏è";
    }
}

function stats(guess, actual) {
    var result = "<tr><td><b>" + guess.tag + "</b></td>";
    if (guess.race == actual.race) {
        result += "<td>üü¢ " + guess.race + "</td>"
    } else {
        result += "<td>üî¥ " + guess.race + "</td>"
    }
    if (guess.country == actual.country) {
        result += "<td>üü¢ " + guess.country + "</td>"
    } else {
        result += "<td>üî¥ " + guess.country + "</td>"
    }
    if (guess.rating == actual.rating) {
        result += "<td>rating üü¢</td>"
    } else if (guess.rating < actual.rating) {
        result += "<td>rating ‚¨ÜÔ∏è</td>"
    } else {
        result += "<td>rating ‚¨áÔ∏è</td>"
    }
    if (!birthdayEmptyOrNull(guess) && !birthdayEmptyOrNull(actual)) {
        const guessBirthday = new Date(guess.birthday);
        const actualBirthday = new Date(actual.birthday);
        if (guessBirthday.getFullYear() == actualBirthday.getFullYear() && guessBirthday.getMonth() == actualBirthday.getMonth()) {
            result += "<td>üü¢ " + guess.birthday + "</td>"
        } else if (guessBirthday.getFullYear() == actualBirthday.getFullYear()) {
            result += "<td>üü°" + beforeOrAfter(guessBirthday, actualBirthday) + " " + guess.birthday + "</td>"
        } else {
            result += "<td>üî¥" + beforeOrAfter(guessBirthday, actualBirthday) + " " + guess.birthday + "</td>"
        }
    }
    if (formatActive(guess.position) == formatActive(actual.position)) {
        result += "<td>üü¢" + formatActive(guess.position) + "</td>";
     } else {
         result += "<td>üî¥" + formatActive(guess.position) + "</td>";
     }
    result += "</tr>"

    document.getElementById('result-display').innerHTML = result + document.getElementById('result-display').innerHTML;
}

function guess(tag) {
    const foundPlayers = players.filter(x => x.tag === tag);
    if (foundPlayers.length <= 0) {
        alert('not found, try again!');
        return;
    } else if (foundPlayers.length > 1) {
        alert('error: multiple players found!');
        return;
    }

    number_of_guesses--;
    document.getElementById('number-of-tries').innerHTML = number_of_guesses;
    if (foundPlayers[0].id == main_player.id) {
        stats(foundPlayers[0], main_player);
        document.getElementById('result-display').innerHTML = "<tr>You won!</tr>" + document.getElementById('result-display').innerHTML
        alert('You won! It was: ' + main_player.tag);
        return;
    } else {
        stats(foundPlayers[0], main_player);
    }
    if (number_of_guesses <= 0) {
        stats(main_player, main_player);
        document.getElementById('result-display').innerHTML = "<tr>You lost!</tr>" + document.getElementById('result-display').innerHTML
        alert('sorry you lost. Target player was: ' + main_player.tag)
    }
}

function playersList() {
    var result = "";
    for (i = 0; i < players.length; i++) {
        result += i + ": " + players[i].tag + "<br/>";
    }
    document.getElementById('player-display').innerHTML = result;
}
